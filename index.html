<!DOCTYPE html>
<html lang="en" data-theme="system">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f172a" />
  <title>Leitner Schedule</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icons/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="app-title">Leitner Schedule</span>
      <span id="dayCounter" class="muted"></span>
    </div>
    <button id="settingsBtn" class="settings-only" aria-label="Open settings">⚙️</button>
  </header>

  <main class="container">
    <!-- Welcome (first run) -->
    <section id="welcome" class="card" hidden>
      <h1>Welcome</h1>
      <p>This app tracks which levels of your <strong>physical Leitner box</strong> you should review each day.</p>
      <button id="startScheduleBtn" class="primary">Start new schedule</button>
    </section>

    <!-- Status / Backlog banner -->
    <section id="status" class="banner" hidden></section>
    
    <!-- Success message -->
    <section id="successMessage" class="success-banner" hidden></section>


    <!-- Undo toaster -->
    <div id="undoToaster" class="undo-toaster" hidden>
      <span id="undoMessage"></span>
      <button id="undoBtn" class="undo-toaster-btn">Undo</button>
    </div>

    <!-- Sectioned Level Grid -->
    <div id="sectionedGrid">
      <!-- Next Up Section -->
      <section id="nextUpSection" class="grid-section" hidden>
        <h2 class="section-header">Next Up</h2>
        <div id="nextUpGrid" class="section-grid"></div>
      </section>

      <!-- Others Due Section -->
      <section id="othersDueSection" class="grid-section" hidden>
        <h2 class="section-header">Others Due</h2>
        <div id="othersDueGrid" class="section-grid"></div>
      </section>

      <!-- Caught Up Section -->
      <section id="caughtUpSection" class="grid-section" hidden>
        <h2 class="section-header">Caught up, see you tomorrow!</h2>
        <div id="caughtUpGrid" class="section-grid"></div>
      </section>

      <!-- All Caught Up State -->
      <section id="allCaughtUpState" class="all-caught-up-card" hidden>
        <h2>Caught up, see you tomorrow!</h2>
        <p class="muted">All levels are scheduled for future dates.</p>
      </section>
    </div>
  </main>


  <!-- Settings modal -->
  <dialog id="settingsDialog">
    <form method="dialog" class="settings-form">
      <h3>Settings</h3>
      <label class="field">
        <span>Theme</span>
        <select id="themeSelect">
          <option value="system">System</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </label>

      <div class="settings-actions">
        <button id="exportBtn" type="button">Export JSON</button>
        <label class="file-btn">
          Import JSON
          <input id="importInput" type="file" accept="application/json" hidden>
        </label>
      </div>

      <hr />

      <button id="resetBtn" class="danger" type="button">Reset schedule…</button>
      <menu>
        <button value="cancel">Close</button>
      </menu>
    </form>
  </dialog>

  <template id="levelTileTemplate">
    <div class="level-tile">
      <div class="level-head">
        <span class="level-badge">L<span class="level-number"></span></span>
        <span class="due-badge" hidden>Due today</span>
        <span class="past-due-badge" hidden>Past Due</span>
      </div>
      <div class="level-body">
        <div class="dates">
          <div class="label">Next due</div>
          <div class="value next-due"></div>
        </div>
        <button class="mark-done-btn primary" hidden>Mark as Done</button>
      </div>
    </div>
  </template>


  <script src="/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>
